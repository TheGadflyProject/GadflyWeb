<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
	<title>The Gadfly Project</title>
	<script src="https://code.jquery.com/jquery-2.2.2.min.js" integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI=" crossorigin="anonymous"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.2/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.2/JSXTransformer.js"></script>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col s12 m3 l3">
            </div>
            <div class="col s12 m9 l9">
                <div id="mount-point">
                </div>
            </div>
        </div>
    </div>

    <script type="text/jsx">
        /*** @jsx React.DOM */
        var Questions = React.createClass({

            getInitialState: function() {
                return {
                    qdata: [], 
                }
            },

            componentDidMount: function() {
                var articleURL = "http://www.nytimes.com/2016/03/31/health/abortion-pill-mifeprex-ru-486-fda.html";
                $.ajax({
                    url: this.props.url,
                    data: {
                        "url": articleURL,
                        },
                    dataType: 'json',
                    cache: false,
                    success: function(d) {
                        this.setState({qdata: d});
                    }.bind(this),
                    error: function(xhr, status, err) {
                        console.error(this.props.url, status, err.toString());
                    }.bind(this)
                    });	
            },

            componentWillUnmount: function() {     
                this.serverRequest.abort();   
            },

            render: function() {
                if (this.state.qdata.questions != undefined) {
                    var questionList = this.state.qdata.questions.map(
                            function(q) { return <Question question={q} />; }
                        );
                }
                return (<table>
                            <thead>
                                <tr>
                                    <th data-field="question">Question</th>
                                    <th data-field="answer">Answer</th>
                                </tr>
                            </thead>
                            <tbody>
                                {questionList}
                            </tbody>
                        </table>);
            }
        });

        var Question = React.createClass({

            getInitialState: function() {
                return {}
            },

            render: function() {
                return (<tr>
                            <td>{this.props.question.question}</td>
                            <td>{this.props.question.answer}</td>
                        </tr>);
            }
        });    

        React.render(<Questions url="https://blooming-crag-89757.herokuapp.com/gadfly/api/v1.0/questions" />, document.getElementById('mount-point') );
    </script>
</body>
</html>
